<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notifications</title>
  <link rel="stylesheet" href="notif.css" />
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="toggle-btn" onclick="toggleSidebar()">☰</div>
    <div class="sidebar-content">
      <h2>Menu</h2>
      <ul>
        <a href="dashboard.html"><li><i>🏠</i><span>dashboard</span></li></a>
        <a href="mainPage.html"><li><i>📅</i><span>appointment</span></li></a>
        <a href="#"><li><i>📄</i><span>documents</span></li></a>
        <a href="settings.html"><li><i>⚙️</i><span>settings</span></li></a>
        <a href="calendar.html"><li><i>🗓️</i><span>calendar</span></li></a>
        <a href="schedule.html"><li><i>⏰</i><span>schedule</span></li></a>
        <a href="notification.html"><li><i>🔔</i><span>notifications</span></li></a>
        <a href="notes.html"><li><i>📝</i><span>notes</span></li></a>
      </ul>
    </div>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="main">
    <h2 class="page-title">Notifications</h2>

   

    <!-- Dynamic notifications will load here -->
    <div class="notification-list" id="dynamic-notifications"></div>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("collapsed");
    }

    function logout() {
      alert("Logging out...");
    }

    // Dismiss static notifications
    document.querySelectorAll(".dismiss-btn").forEach((btn) => {
      btn.addEventListener("click", function () {
        this.parentElement.remove();
      });
    });

   async function loadNotifications() {
  const container = document.getElementById("dynamic-notifications");

  try {
    const [tasksRes, scheduleRes] = await Promise.all([
      fetch("/tasks"),
      fetch("/schedule")
    ]);

    const tasks = await tasksRes.json();
    const schedules = await scheduleRes.json();

    // Show task notifications
    if (Array.isArray(tasks)) {
      tasks.forEach(task => {
        const el = createNotification("New Task", task.title || "Untitled task");
        container.prepend(el);  // Add to top
      });
    }

    // Show schedule notifications
    if (Array.isArray(schedules)) {
      schedules.forEach(item => {
        const time = item.time || "unknown time";
        const name = item.event || item.title || "Scheduled Event";
        const el = createNotification("New Schedule", `${name} at ${time}`);
        container.prepend(el);  // Add to top
      });
    }
  } catch (err) {
    console.error("Failed to load notifications", err);
    const errMsg = createNotification("Error", "Could not load notifications.");
    container.prepend(errMsg);  // Add error message to top
  }
}


    function createNotification(title, message) {
      const wrapper = document.createElement("div");
      wrapper.className = "notification";
      wrapper.innerHTML = `
        <div class="notification-content">
          <h4>${title}</h4>
          <p>${message}</p>
          <span class="time">Just now</span>
        </div>
        <button class="dismiss-btn">&times;</button>
      `;
      wrapper.querySelector(".dismiss-btn").addEventListener("click", () => wrapper.remove());
      return wrapper;
    }

    // Load dynamic notifications on page load
    window.addEventListener("DOMContentLoaded", loadNotifications);
  </script>
</body>
</html>
